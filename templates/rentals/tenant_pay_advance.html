{% extends "base.html" %}
{% block title %}Make Payment - RealEstate360+{% endblock %}

{% block content %}
<div class="min-h-screen flex bg-gray-50">

  <!-- Sidebar -->
  <aside class="w-72 bg-emerald-900 text-white flex flex-col">
    <div class="px-6 py-6 border-b border-emerald-800">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-lg bg-emerald-800 flex items-center justify-center font-bold">RE</div>
        <div>
          <div class="text-lg font-bold">RealEstate360+</div>
          <div class="text-xs text-emerald-200">Tenant Portal</div>
        </div>
      </div>
    </div>

    <nav class="px-4 py-6 space-y-2 flex-1">
      <a href="{% url 'tenant_dashboard' %}" class="block px-4 py-3 rounded-lg hover:bg-emerald-800/40 transition">
        Dashboard
      </a>

      <a href="{% url 'tenant_billing' %}" class="block px-4 py-3 rounded-lg hover:bg-emerald-800/40 transition">
        View Billing
      </a>

      <a href="{% url 'tenant_pay_advance' %}"
         class="block px-4 py-3 rounded-lg bg-emerald-800/60 hover:bg-emerald-800 transition font-semibold">
        Make Payment
      </a>

      <a href="{% url 'maintenance_list' %}" class="block px-4 py-3 rounded-lg hover:bg-emerald-800/40 transition">
        Maintenance Requests
      </a>

      <a href="{% url 'report_issue' %}" class="block px-4 py-3 rounded-lg hover:bg-emerald-800/40 transition">
        Report Issue
      </a>
    </nav>

    <div class="px-4 py-6 border-t border-emerald-800">
      <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="w-full text-left px-4 py-3 rounded-lg hover:bg-emerald-800/40 transition">
          Logout
        </button>
      </form>
    </div>
  </aside>

  <!-- Main -->
  <main class="flex-1 px-10 py-8">
    <h1 class="text-4xl font-extrabold text-gray-900">Make Payment</h1>
    <p class="text-gray-600 mt-2">
      Preview your payment total. When you click Pay, you’ll be redirected to Manual GCash.
    </p>

    <!-- Preview controls + total -->
    <div class="mt-6 bg-white rounded-2xl shadow-sm border p-6">
      <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">

        <form method="get" class="w-full lg:max-w-md">
          <label class="text-sm font-semibold text-gray-700">Number of Months</label>
          <select name="months_to_pay"
                  class="mt-2 w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-emerald-200"
                  onchange="this.form.submit()">
            {% for n in months_options %}
              <option value="{{ n }}" {% if months_to_pay == n %}selected{% endif %}>
                {{ n }} Month{% if n != 1 %}s{% endif %}
              </option>
            {% endfor %}
          </select>

          <p class="text-xs text-gray-500 mt-2">
            {% if has_pending %}
              You have {{ unpaid_count }} pending unpaid bill(s). Preview shows oldest unpaid first.
            {% else %}
              No pending bills. Preview shows advance months.
            {% endif %}
          </p>
        </form>

        <div class="w-full lg:max-w-sm rounded-2xl border bg-emerald-50 p-6">
          <div class="text-sm text-gray-600">Total Amount (Preview)</div>
          <div class="text-3xl font-extrabold text-emerald-700 mt-2">
            ₱{{ total_amount|default:"0.00" }}
          </div>

          <!-- PAY button -> POST -> view redirects to manual -->
          <form method="post" class="mt-4">
            {% csrf_token %}
            <button type="submit"
                    class="w-full px-4 py-3 rounded-xl bg-emerald-700 hover:bg-emerald-800 text-white font-semibold transition">
              Pay (Manual GCash)
            </button>
          </form>

          <div class="text-xs text-gray-500 mt-3">
            Next step: show QR/number and submit the GCash reference number.
          </div>
        </div>

      </div>
    </div>

    <!-- Preview table -->
    <div class="mt-8 bg-white rounded-2xl shadow-sm border overflow-hidden">
      <div class="px-6 py-5 border-b">
        <h2 class="text-lg font-bold text-gray-900">Payment Preview</h2>
        <p class="text-sm text-gray-500 mt-1">This is only a preview. Admin verification happens in Manual GCash.</p>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Month</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Rent</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Water</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Penalty</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Total</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">Due Date</th>
            </tr>
          </thead>

          <tbody class="divide-y">
            {% for r in preview_rows %}
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 text-sm">{{ r.month_label }}</td>
                <td class="px-4 py-3 text-sm">₱{{ r.rent }}</td>
                <td class="px-4 py-3 text-sm">₱{{ r.water|default:"0.00" }}</td>
                <td class="px-4 py-3 text-sm">
                  {% if r.penalty and r.penalty != 0 %}₱{{ r.penalty }}{% else %}-{% endif %}
                </td>
                <td class="px-4 py-3 text-sm font-semibold">₱{{ r.total }}</td>
                <td class="px-4 py-3 text-sm">
                  {% if r.due_date %}{{ r.due_date|date:"Y-m-d" }}{% else %}-{% endif %}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="6" class="px-6 py-6 text-sm text-gray-500">
                  No preview available.
                </td>
              </tr>
            {% endfor %}
          </tbody>

        </table>
      </div>
    </div>

  </main>
</div>
{% endblock %}